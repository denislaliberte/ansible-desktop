#!/usr/bin/env ansible-playbook
---
- hosts: local
  become: true
  become_user: "{{user}}"
  become_method: sudo
  tasks:
    - name: Add apt repository
      apt_repository: repo="{{item}}" state=present
      with_items:
          - ppa:maarten-baert/simplescreenrecorder
          - ppa:team-xbmc/ppa
    - name: Install list of apt packages
      apt: name="{{item}}" state=installed
      with_items:
           # utils
           - tmux
           - tree
           - simplescreenrecorder
           - kodi
           # language
           - ruby-full
           # utils
           - pass
           - dtrx
           - pandoc
           - texlive-full
           # op
           - virtualbox
           # db 
           - sqlite3 
           - postgresql
           - postgresql-contrib
           - pgadmin3
           - mariadb-server-5.5
           - libmysqlclient-dev
           # servers
           - apache2
           # misc
           - libpq-dev
           - focuswriter
           - kdiff3
           # ansible-lint
           - libffi-dev
           # python-ldap
           - libldap2-dev
           - libsasl2-dev
           - libssl-dev
           # js
           - nodejs
           - npm
           # perl
           - cpanminus
           # Auth
           - slapd
           - ldap-utils
           - phpldapadmin

    - name: enamble mod_rewite
      apache2_module: name="{{item}}" state=present
      with_items:
           - rewrite
           - proxy

    - name: symlink node js
      file: src=/usr/bin/nodejs dest=/usr/bin/node state=link

    - name: Install Python Tools (pip)
      pip: name="{{item}}"
      with_items:
           - virtualenvwrapper
           - ansible-lint

    - name: Add virtualenv workon home to zshrc
      lineinfile: dest=/home/dlaliberte/.zshrc line="export WORKON_ROME=~/Envs"

    - name: Add virtualenvwrapper to zsh
      lineinfile: dest=/home/dlaliberte/.zshrc line="source /usr/local/bin/virtualenvwrapper.sh"

    - name: Install homeshick to manage dotfiles
      git: repo=https://github.com/andsens/homeshick.git dest=/home/dlaliberte/.homesick/repos/homeshick update=no
      #todo get home from variables

    - name: Add Homeshick to bashrc
      lineinfile: dest=/home/dlaliberte/.zshrc line="source /home/dlaliberte/.homesick/repos/homeshick/homeshick.sh"

    - name: Download dotfiles
      git: repo=https://github.com/denislaliberte/dotfiles.git dest=/home/dlaliberte/.homesick/repos/dotfiles update=no

    - name: Install js tools
      npm: name="{{item}}" global=yes
      with_items:
           - jslint
           - eslint
           - eslint-plugin-requirejs
           - requirejs
           - gulp-cli
           - wat

    #- name: Install perl tools
    #  cpanm: name=App::GitGot


  roles:
    - { role: thydel.vagrant, vagrant_baseurl: "https://releases.hashicorp.com/vagrant/1.8.4", vagrant_debfile: "vagrant_1.8.4_x86_64.deb"}
#    - { role: rvm_io.rvm1-ruby, tags: ruby, sudo: True, rvm1_gpg_key_server: 'hkp://keys.gnupg.net:80' }
#    - { role: mashimom.oh-my-zsh, ohmyzsh_theme: 'lambda', ohmyzsh_user: 'dlaliberte' }
#    - { role: ANXS.postgresql  }
#    - { role: hadenlabs.virtualenvwrapper }
#    - cmprescott.chrome
